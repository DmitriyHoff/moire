import{_ as x}from"./BreadcrumbTrail-471eeca1.js";import{r as k,n as R,S as g,o as l,a as n,t as r,l as h,F as q,d as C,b as e,w as y,D as w,f as U,c as D,u as b,i as N,m as S,g as E,z as V,C as $,j as I,q as L,k as M,x as O}from"./index-ca4a827e.js";import{t as P}from"./color-dictionary-be2850f0.js";const F={class:"cart__option-item"},j=e("h3",{class:"cart__title"},"Доставка",-1),K={key:0,class:"form__error"},W={key:1,class:"cart__options options"},Z={class:"options__label"},G=["value"],H={class:"options__value"},J={key:0},Q={__name:"CheckoutDelivery",props:["error"],emits:["update:delivery"],setup(f,{emit:d}){const m=k(!0),i=k({}),u=k(0);return R(()=>u.value,s=>d("update:delivery",i.value.find(t=>t.id===s))),g.getDeliveries().then(s=>{i.value=s,i.value instanceof Array&&i.value.length>0&&(u.value=i.value[0].id),m.value=!1}),(s,t)=>{var a,v;return l(),n("li",F,[j,(a=f.error.request)!=null&&a.deliveryTypeId?(l(),n("p",K,r((v=f.error.request)==null?void 0:v.deliveryTypeId),1)):h("",!0),m.value?h("",!0):(l(),n("ul",W,[(l(!0),n(q,null,C(i.value,p=>(l(),n("li",{class:"options__item",key:p.id},[e("label",Z,[y(e("input",{class:"options__radio sr-only",type:"radio",name:"delivery",value:p.id,"onUpdate:modelValue":t[0]||(t[0]=c=>u.value=c)},null,8,G),[[w,u.value]]),e("span",H,[U(r(p.title)+" ",1),p.price>0?(l(),n("strong",J,r(s.$format.currRUB(p.price)),1)):h("",!0)])])]))),128))]))])}}},Y={class:"cart__option-item"},ee=e("h3",{class:"cart__title"},"Оплата",-1),te={key:0,class:"form__error"},se={class:"cart__options options"},oe={class:"options__label"},ae=["value"],re={class:"options__value"},le={__name:"CheckoutPayment",props:["modelValue","deliveryTypeId","error"],emits:["update:modelValue"],setup(f,{emit:d}){const m=f,i=k({});R(()=>m.deliveryTypeId,()=>{g.getPayments(m.deliveryTypeId).then(s=>{i.value=s,i.value instanceof Array&&i.value.length>0&&(u.value=i.value[0].id)})});const u=D({get(){return m.modelValue},set(s){d("update:modelValue",s)}});return(s,t)=>{var a,v;return l(),n("li",Y,[ee,(a=f.error.request)!=null&&a.paymentTypeId?(l(),n("p",te,r((v=f.error.request)==null?void 0:v.paymentTypeId),1)):h("",!0),e("ul",se,[(l(!0),n(q,null,C(i.value,p=>(l(),n("li",{key:p.id,class:"options__item"},[e("label",oe,[y(e("input",{class:"options__radio sr-only",type:"radio",name:"pay",value:p.id,"onUpdate:modelValue":t[0]||(t[0]=c=>N(u)?u.value=c:null)},null,8,ae),[[w,b(u)]]),e("span",re,r(p.title),1)])]))),128))])])}}},ne={class:"cart__form form",action:"#",method:"POST"},_e={class:"cart__field"},ie={class:"cart__data"},ce={class:"form__label"},ue=e("span",{class:"form__value"},"ФИО",-1),de={key:0,class:"form__error"},pe={class:"form__label"},me=e("span",{class:"form__value"},"Адрес доставки",-1),he={key:0,class:"form__error"},fe={class:"form__label"},ve=e("span",{class:"form__value"},"Телефон",-1),ye={key:0,class:"form__error"},ke={class:"form__label"},be=e("span",{class:"form__value"},"Email",-1),$e={key:0,class:"form__error"},Ve={class:"form__label"},Ie=e("span",{class:"form__value"},"Комментарий к заказу",-1),Ue={class:"cart__options"},ge={class:"cart__block"},qe={class:"cart__orders"},Ce={class:"cart__sku"},Te={class:"cart__total-count"},Xe={class:"cart__total"},ze={class:"cart__order-price"},Ae={class:"cart__order-price"},Be=["onClick"],Re=e("span",{class:"button__text"},"Оформить заказ",-1),we=[Re],xe={key:0,class:"cart__error form__error-block"},De=e("h4",null,"Заявка не отправлена!",-1),Ne=e("p",null,"Похоже произошла ошибка. Попробуйте отправить снова или перезагрузите страницу.",-1),Se=[De,Ne],Ee={__name:"CheckoutForm",setup(f){const d=S(),m=E(),i=k(!1),u=k(!1),s=V({}),t=V({}),a=V({name:"",address:"",phone:"",email:"",deliveryTypeId:0,paymentTypeId:0,comment:""});function v(){i.value=!1,u.value=!0;const c=d.getUser();g.makeOrder(c==null?void 0:c.accessKey,a).then(_=>{_.error?(Object.assign(s,_.error),i.value=!0):m.push({name:"order",params:{id:_.id}}),u.value=!1})}const p=V({tokens:{A:{pattern:/[A-ZА-ЯЁ]/,transform:c=>c.toLocaleUpperCase()},z:{pattern:/[a-zа-яё]/,transform:c=>c.toLocaleLowerCase(),multiple:!0}}});return(c,_)=>{var X,z,A,B;const T=O("maska");return l(),n("form",ne,[e("div",_e,[e("div",ie,[e("label",ce,[y(e("input",{"data-maska":"Az Az Az",class:"form__input",type:"text",name:"name",placeholder:"Введите ваше полное имя","onUpdate:modelValue":_[0]||(_[0]=o=>a.name=o)},null,512),[[T,void 0,p],[$,a.name]]),ue,(X=s.request)!=null&&X.name?(l(),n("span",de,r(s.request.name),1)):h("",!0)]),e("label",pe,[y(e("input",{class:"form__input",type:"text",name:"address",placeholder:"Введите ваш адрес","onUpdate:modelValue":_[1]||(_[1]=o=>a.address=o)},null,512),[[$,a.address]]),me,(z=s.request)!=null&&z.address?(l(),n("span",he,r(s.request.address),1)):h("",!0)]),e("label",fe,[y(e("input",{"data-maska":"+7(###) ###-##-##","data-maska-eager":"",class:"form__input",type:"tel",name:"phone",placeholder:"+7(XXX) XXX-XX-XX","onUpdate:modelValue":_[2]||(_[2]=o=>a.phone=o)},null,512),[[T],[$,a.phone]]),ve,(A=s.request)!=null&&A.phone?(l(),n("span",ye,r(s.request.phone),1)):h("",!0)]),e("label",ke,[y(e("input",{class:"form__input",type:"email",name:"email",placeholder:"Введи ваш Email","onUpdate:modelValue":_[3]||(_[3]=o=>a.email=o)},null,512),[[$,a.email]]),be,(B=s.request)!=null&&B.email?(l(),n("span",$e,r(s.request.email),1)):h("",!0)]),e("label",Ve,[y(e("textarea",{class:"form__input form__input--area",name:"comments",placeholder:"Ваши пожелания","onUpdate:modelValue":_[4]||(_[4]=o=>a.comment=o)},null,512),[[$,a.comment]]),Ie])]),e("ul",Ue,[I(Q,{error:s,"onUpdate:delivery":_[5]||(_[5]=o=>{t=o,a.deliveryTypeId=t.id})},null,8,["error"]),I(le,{modelValue:a.paymentTypeId,"onUpdate:modelValue":_[6]||(_[6]=o=>a.paymentTypeId=o),deliveryTypeId:a.deliveryTypeId,error:s},null,8,["modelValue","deliveryTypeId","error"])])]),e("div",ge,[e("ul",qe,[(l(!0),n(q,null,C(b(d).cart.items,o=>(l(),n("li",{class:"cart__order",key:o.id},[e("h3",null,r(o.product.title),1),e("b",null,r(c.$format.currRUB(o.price*o.quantity)),1),e("p",Ce,[e("span",null,"Цвет: "+r(b(P)(o.product.colors[0].color.title)),1),e("span",null,"Размер: "+r(o.size.title),1)]),e("span",Te,r(o.quantity)+" шт. × "+r(c.$format.currRUB(o.price)),1)]))),128))]),e("div",Xe,[e("p",null,r(t==null?void 0:t.title)+":",1),e("p",ze,r(t!=null&&t.price&&(t==null?void 0:t.price)>0?c.$format.currRUB(t.price):"бесплатно"),1),e("p",null,[U(" Итого: "),e("b",null,r(b(d).count),1),U(" "+r(c.$format.countText(b(d).count))+" на сумму: ",1)]),e("p",Ae,r(c.$format.currRUB(+b(d).totalPrice+ +(t==null?void 0:t.price))),1)]),e("button",{class:L(["cart__button button button--primery",u.value?"button--loading":""]),type:"submit",onClick:M(v,["prevent"])},we,10,Be)]),i.value?(l(),n("div",xe,Se)):h("",!0)])}}},Le={class:"content container"},Me={class:"content__top"},Oe=e("div",{class:"content__row"},[e("h1",{class:"content__title"},"Оформление заказа")],-1),Pe={class:"cart"},We={__name:"CheckoutView",setup(f){const d=k([{title:"Каталог",route:{name:"main"}},{title:"Корзина",route:{name:"cart"}},{title:"Оформление заказа",route:{name:"#"}}]);return(m,i)=>(l(),n("main",Le,[e("div",Me,[I(x,{links:d.value},null,8,["links"]),Oe]),e("section",Pe,[I(Ee)])]))}};export{We as default};
