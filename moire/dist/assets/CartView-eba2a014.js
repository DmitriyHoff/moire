import{C as B,r as h,o as r,a as l,j as U,m as V,b as t,t as _,f as m,E as K,u as b,w as C,S,G as N,s as I,c as O,F as R,d as j,k as w,l as D,p as E}from"./index-ffbe57d3.js";import{S as L}from"./sku-generator-e3173cad.js";import{g as P}from"./color-dictionary-6d7c63d4.js";import{n as q}from"./no-image-7601bee4.js";import{_ as x}from"./BreadcrumbTrail-467ca9df.js";const F={class:"cart__item product"},M=["src","alt"],A={class:"product__content"},G={class:"product__info-wrap"},Q={class:"product__title"},H={class:"product__info product__info--color"},J={class:"product__size"},W={class:"product__code"},X={class:"product__counter form__counter"},Y={key:0,size:"16 16",symbol:"icon-delete"},Z={key:1,size:"12 12",symbol:"icon-minus"},tt=["value"],et={size:"12 12",symbol:"icon-plus"},st={class:"product__price"},ot={__name:"CartItem",props:["item"],emits:["update:cart","confirm:delete"],setup(a,{emit:o}){const n=a,u=300,k=B(),p=h(n.item.product),i=h(n.item.quantity),c=h(new L({id:p.value.id,color:n.item.color.color.id,size:n.item.size.id}).toString());let s;function v(){i.value++,$()}function y(){if(i.value>1)i.value--;else{$(!0);return}$()}function $(d=!1){clearTimeout(s),s=setTimeout(()=>{const e=k.getUser();d?S.deleteBasketProduct(n.item.id,e==null?void 0:e.accessKey).then(f=>{o("update:cart",f)}):S.changeBasketQuantity(n.item.id,i.value,e==null?void 0:e.accessKey).then(f=>{o("update:cart",f)})},u)}function z(d){var e;return d?(e=d[0])==null?void 0:e.file.url:q}return(d,e)=>{const f=N("RouterLink"),g=I("svg");return r(),l("li",F,[U(f,{class:"product__pic",to:{name:"product",params:{id:a.item.product.id}}},{default:V(()=>[t("img",{src:z(a.item.color.gallery),width:"120",height:"120",alt:a.item.title},null,8,M)]),_:1},8,["to"]),t("div",A,[t("div",G,[t("h3",Q,_(p.value.title),1),t("p",H,[m(" Цвет: "),t("span",null,[t("i",{style:K(`background-color: ${a.item.color.color.code}`)},null,4),m(" "+_(b(P)(a.item.color.color.title)),1)])]),t("p",J,[m(" Размер: "),t("span",null,_(a.item.size.title),1)]),t("span",W," Артикул: "+_(c.value),1)]),t("div",X,[t("button",{type:"button","aria-label":"Убрать один товар",onClick:e[0]||(e[0]=T=>y())},[i.value===1?C((r(),l("svg",Y,null,512)),[[g]]):C((r(),l("svg",Z,null,512)),[[g]])]),t("input",{type:"text",value:i.value,name:"count"},null,8,tt),t("button",{type:"button","aria-label":"Добавить один товар",onClick:e[1]||(e[1]=T=>v())},[C((r(),l("svg",et,null,512)),[[g]])])])]),t("div",st,_(d.$format.currRUB(p.value.price*i.value)),1)])}}},nt={class:"content container"},ct={class:"content__top"},it={class:"cart"},rt={key:0,class:"cart__form form",action:"#",method:"POST"},at={class:"cart__field"},lt={class:"cart__list"},ut={class:"cart__block"},dt=t("p",{class:"cart__desc"},"Мы посчитаем стоимость доставки на следующем этапе",-1),_t={class:"cart__price"},mt={key:1},pt=t("h2",null,"Ой, пусто!",-1),vt=t("p",null,[m(" Ваша корзина пуста, откройте каталог "),t("br"),m("и выбирайте лучшие товары с бесплатной доставкой ")],-1),ft=t("br",null,null,-1),gt={__name:"CartView",setup(a){const o=B(),n=h(!1),u=o.getUser();u!=null&&u.accessKey&&(n.value=!0,S.getBasket(u.accessKey).then(c=>{Object.assign(o.cart,c),o.setUser(o.cart.user),n.value=!1}));const k=O(()=>o.cart.items.reduce((c,s)=>c+=s.price*s.quantity,0)),p=h([{title:"Каталог",route:{name:"main"}},{title:"Корзина",route:{path:"#"}}]);function i(c){Object.assign(o.cart,c)}return(c,s)=>(r(),l("main",nt,[t("div",ct,[U(x,{links:p.value},null,8,["links"])]),t("section",it,[!n.value&&b(o).count>0?(r(),l("form",rt,[t("div",at,[t("ul",lt,[(r(!0),l(R,null,j(b(o).cart.items,v=>(r(),E(ot,{key:v.id,item:v,"onUpdate:cart":s[0]||(s[0]=y=>i(y))},null,8,["item"]))),128))])]),t("div",ut,[dt,t("p",_t,[m(" Итого: "),t("span",null,_(c.$format.currRUB(b(k))),1)]),t("button",{class:"cart__button button button--primery",type:"submit",onClick:s[1]||(s[1]=w(()=>c.$router.push({name:"checkout"}),["prevent"]))}," Оформить заказ ")])])):n.value?D("",!0):(r(),l("div",mt,[pt,vt,ft,t("button",{class:"item__button button button--primery",onClick:s[2]||(s[2]=w(v=>c.$router.push({name:"products"}),["prevent"]))}," Начать покупки ")]))])]))}};export{gt as default};
