import{_ as E}from"./BreadcrumbTrail-2cc41b58.js";import{r as y,n as N,S as U,o as r,a as l,t as a,l as v,F as g,d as q,b as e,w as k,D as S,f as I,c as L,u as b,i as M,m as O,g as P,z as T,C as $,j as V,q as F,k as j,x as K}from"./index-1eba4c76.js";import{t as W}from"./color-dictionary-be2850f0.js";const Z={class:"cart__option-item"},G=e("h3",{class:"cart__title"},"Доставка",-1),H={key:0,class:"form__error"},J={key:1,class:"cart__options options"},Q={class:"options__label"},Y=["value"],ee={class:"options__value"},te={key:0},se={__name:"CheckoutDelivery",props:["error"],emits:["update:delivery"],setup(h,{emit:d}){const m=y(!0),_=y({}),u=y(0);return N(()=>u.value,t=>d("update:delivery",_.value.find(c=>c.id===t))),U.getDeliveries().then(t=>{_.value=t,_.value instanceof Array&&_.value.length>0&&(u.value=_.value[0].id),m.value=!1}),(t,c)=>{var o,f;return r(),l("li",Z,[G,(o=h.error.request)!=null&&o.deliveryTypeId?(r(),l("p",H,a((f=h.error.request)==null?void 0:f.deliveryTypeId),1)):v("",!0),m.value?v("",!0):(r(),l("ul",J,[(r(!0),l(g,null,q(_.value,p=>(r(),l("li",{class:"options__item",key:p.id},[e("label",Q,[k(e("input",{class:"options__radio sr-only",type:"radio",name:"delivery",value:p.id,"onUpdate:modelValue":c[0]||(c[0]=i=>u.value=i)},null,8,Y),[[S,u.value]]),e("span",ee,[I(a(p.title)+" ",1),p.price>0?(r(),l("strong",te,a(t.$format.currRUB(p.price)),1)):v("",!0)])])]))),128))]))])}}},oe={class:"cart__option-item"},ae=e("h3",{class:"cart__title"},"Оплата",-1),re={key:0,class:"form__error"},le={class:"cart__options options"},ne={class:"options__label"},_e=["value"],ie={class:"options__value"},ce={__name:"CheckoutPayment",props:["modelValue","deliveryTypeId","error"],emits:["update:modelValue"],setup(h,{emit:d}){const m=h,_=y({});N(()=>m.deliveryTypeId,()=>{U.getPayments(m.deliveryTypeId).then(t=>{_.value=t,_.value instanceof Array&&_.value.length>0&&(u.value=_.value[0].id)})});const u=L({get(){return m.modelValue},set(t){d("update:modelValue",t)}});return(t,c)=>{var o,f;return r(),l("li",oe,[ae,(o=h.error.request)!=null&&o.paymentTypeId?(r(),l("p",re,a((f=h.error.request)==null?void 0:f.paymentTypeId),1)):v("",!0),e("ul",le,[(r(!0),l(g,null,q(_.value,p=>(r(),l("li",{key:p.id,class:"options__item"},[e("label",ne,[k(e("input",{class:"options__radio sr-only",type:"radio",name:"pay",value:p.id,"onUpdate:modelValue":c[0]||(c[0]=i=>M(u)?u.value=i:null)},null,8,_e),[[S,b(u)]]),e("span",ie,a(p.title),1)])]))),128))])])}}},ue={class:"cart__form form",action:"#",method:"POST"},de={class:"cart__field"},pe={class:"cart__data"},me={class:"form__label"},ve=e("span",{class:"form__value"},"ФИО",-1),he={key:0,class:"form__error"},ye={class:"form__label"},fe=e("span",{class:"form__value"},"Адрес доставки",-1),ke={key:0,class:"form__error"},be={class:"form__label"},$e=e("span",{class:"form__value"},"Телефон",-1),Ve={key:0,class:"form__error"},Te={class:"form__label"},Ie=e("span",{class:"form__value"},"Email",-1),Ue={key:0,class:"form__error"},ge={class:"form__label"},qe=e("span",{class:"form__value"},"Комментарий к заказу",-1),Ce={class:"cart__options"},Xe={class:"cart__block"},ze={class:"cart__orders"},Ae={class:"cart__sku"},Be={class:"cart__total-count"},Re={class:"cart__total"},we={class:"cart__order-price"},xe={class:"cart__order-price"},De=["onClick"],Ne=e("span",{class:"button__text"},"Оформить заказ",-1),Se=[Ne],Ee={key:0,class:"cart__error form__error-block"},Le=e("h4",null,"Заявка не отправлена!",-1),Me=e("p",null,"Похоже произошла ошибка. Попробуйте отправить снова или перезагрузите страницу.",-1),Oe=[Le,Me],Pe={__name:"CheckoutForm",setup(h){const d=O(),m=P(),_=y(!1),u=y(!1),t=T({}),c=y({}),o=T({name:"",address:"",phone:"",email:"",deliveryTypeId:0,paymentTypeId:0,comment:""});function f(){_.value=!1,u.value=!0;const i=d.getUser();U.makeOrder(i==null?void 0:i.accessKey,o).then(n=>{n.error?(Object.assign(t,n.error),_.value=!0):m.push({name:"order",params:{id:n.id}}),u.value=!1})}const p=T({tokens:{A:{pattern:/[A-ZА-ЯЁ]/,transform:i=>i.toLocaleUpperCase()},z:{pattern:/[a-zа-яё]/,transform:i=>i.toLocaleLowerCase(),multiple:!0}}});return(i,n)=>{var X,z,A,B,R,w,x,D;const C=K("maska");return r(),l("form",ue,[e("div",de,[e("div",pe,[e("label",me,[k(e("input",{"data-maska":"Az Az Az",class:"form__input",type:"text",name:"name",placeholder:"Введите ваше полное имя","onUpdate:modelValue":n[0]||(n[0]=s=>o.name=s)},null,512),[[C,void 0,p],[$,o.name]]),ve,(X=t.request)!=null&&X.name?(r(),l("span",he,a(t.request.name),1)):v("",!0)]),e("label",ye,[k(e("input",{class:"form__input",type:"text",name:"address",placeholder:"Введите ваш адрес","onUpdate:modelValue":n[1]||(n[1]=s=>o.address=s)},null,512),[[$,o.address]]),fe,(z=t.request)!=null&&z.address?(r(),l("span",ke,a(t.request.address),1)):v("",!0)]),e("label",be,[k(e("input",{"data-maska":"+7(###) ###-##-##","data-maska-eager":"",class:"form__input",type:"tel",name:"phone",placeholder:"+7(XXX) XXX-XX-XX","onUpdate:modelValue":n[2]||(n[2]=s=>o.phone=s)},null,512),[[C],[$,o.phone]]),$e,(A=t.request)!=null&&A.phone?(r(),l("span",Ve,a(t.request.phone),1)):v("",!0)]),e("label",Te,[k(e("input",{class:"form__input",type:"email",name:"email",placeholder:"Введи ваш Email","onUpdate:modelValue":n[3]||(n[3]=s=>o.email=s)},null,512),[[$,o.email]]),Ie,(B=t.request)!=null&&B.email?(r(),l("span",Ue,a(t.request.email),1)):v("",!0)]),e("label",ge,[k(e("textarea",{class:"form__input form__input--area",name:"comments",placeholder:"Ваши пожелания","onUpdate:modelValue":n[4]||(n[4]=s=>o.comment=s)},null,512),[[$,o.comment]]),qe])]),e("ul",Ce,[V(se,{error:t,"onUpdate:delivery":n[5]||(n[5]=s=>{c.value=s,o.deliveryTypeId=c.value.id})},null,8,["error"]),V(ce,{modelValue:o.paymentTypeId,"onUpdate:modelValue":n[6]||(n[6]=s=>o.paymentTypeId=s),deliveryTypeId:o.deliveryTypeId,error:t},null,8,["modelValue","deliveryTypeId","error"])])]),e("div",Xe,[e("ul",ze,[(r(!0),l(g,null,q(b(d).cart.items,s=>(r(),l("li",{class:"cart__order",key:s.id},[e("h3",null,a(s.product.title),1),e("b",null,a(i.$format.currRUB(s.price*s.quantity)),1),e("p",Ae,[e("span",null,"Цвет: "+a(b(W)(s.product.colors[0].color.title)),1),e("span",null,"Размер: "+a(s.size.title),1)]),e("span",Be,a(s.quantity)+" шт. × "+a(i.$format.currRUB(s.price)),1)]))),128))]),e("div",Re,[e("p",null,a((R=c.value)==null?void 0:R.title)+":",1),e("p",we,a((w=c.value)!=null&&w.price&&((x=c.value)==null?void 0:x.price)>0?i.$format.currRUB(c.value.price):"бесплатно"),1),e("p",null,[I(" Итого: "),e("b",null,a(b(d).count),1),I(" "+a(i.$format.countText(b(d).count))+" на сумму: ",1)]),e("p",xe,a(i.$format.currRUB(+b(d).totalPrice+ +((D=c.value)==null?void 0:D.price))),1)]),e("button",{class:F(["cart__button button button--primery",u.value?"button--loading":""]),type:"submit",onClick:j(f,["prevent"])},Se,10,De)]),_.value?(r(),l("div",Ee,Oe)):v("",!0)])}}},Fe={class:"content container"},je={class:"content__top"},Ke=e("div",{class:"content__row"},[e("h1",{class:"content__title"},"Оформление заказа")],-1),We={class:"cart"},Je={__name:"CheckoutView",setup(h){const d=y([{title:"Каталог",route:{name:"main"}},{title:"Корзина",route:{name:"cart"}},{title:"Оформление заказа",route:{name:"#"}}]);return(m,_)=>(r(),l("main",Fe,[e("div",je,[V(E,{links:d.value},null,8,["links"]),Ke]),e("section",We,[V(Pe)])]))}};export{Je as default};
